import{r as e,R as s,j as t,B as i,y as n,J as r,f as a,E as o,T as c,W as d,I as l,X as m,a as x,m as h,aA as p,a5 as u,a6 as j,aB as y,aC as g,a8 as f,aD as w}from"./index-ElRkoE7H.js";import{T as b}from"./TextField-CuVneWw0.js";import"./useControlled-DkdrZMW3.js";import"./FormControl-CTkNbEnO.js";const v="http://localhost:9000/emo-buddy",S=()=>t.jsxs(i,{sx:{p:2},children:[t.jsx(c,{variant:"h6",gutterBottom:!0,children:"Welcome to Emo Buddy - Your AI Therapeutic Companion"}),t.jsx(h,{severity:"info",icon:t.jsx(p,{}),sx:{mb:2},children:"I'm here to provide emotional support and therapeutic guidance using evidence-based techniques. Everything is confidential and supportive."}),t.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"What I can help with:"}),t.jsxs(u,{dense:!0,children:[t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(g,{color:"success"})}),t.jsx(f,{primary:"Processing difficult emotions"})]}),t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(g,{color:"success"})}),t.jsx(f,{primary:"Managing stress and anxiety"})]}),t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(g,{color:"success"})}),t.jsx(f,{primary:"Developing coping strategies"})]})]}),t.jsxs(h,{severity:"warning",icon:t.jsx(w,{}),sx:{mt:2},children:[t.jsx("b",{children:"Important:"})," I'm an AI companion, not a replacement for professional help. If you're in crisis, please contact emergency services."]}),t.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Ready to chat? Just start typing!"})]}),C=()=>{const[h,p]=e.useState(null),[u,j]=e.useState([]),[y,g]=e.useState(""),[f,w]=e.useState(!1),[C,I]=e.useState(null),T=e.useRef(null),[D,W]=e.useState(!1),E=e.useRef(0);s.useEffect(()=>{var e;null==(e=T.current)||e.scrollIntoView({behavior:"smooth"})},[u]);const R=async()=>{if(!y.trim())return;w(!0),I(null);const e={id:Date.now().toString(),content:y.trim(),isUser:!0,timestamp:new Date};j(s=>[...s,e]),g("");try{if(D){if(h){if(!h||!e.content)return I("Session or message missing."),void w(!1);const s=await fetch(`${v}/continue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:h,user_message:e.content})});if(!s.ok)throw new Error((await s.json()).detail||"Failed to continue session");const t=await s.json();j(e=>[...e,{id:(Date.now()+1).toString(),content:t.response,isUser:!1,timestamp:new Date}])}}else{const s=await fetch(`${v}/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_message:e.content})});if(!s.ok)throw new Error((await s.json()).detail||"Failed to start session");const t=await s.json();p(t.session_id),j(e=>[...e,{id:(Date.now()+1).toString(),content:t.response,isUser:!1,timestamp:new Date}]),W(!0)}}catch(s){I(s.message||"Something went wrong.")}finally{w(!1)}};return t.jsx(i,{sx:{maxWidth:600,mx:"auto",mt:4,p:2},children:t.jsxs(n,{elevation:3,sx:{p:3,borderRadius:4},children:[t.jsxs(r,{direction:"row",alignItems:"center",spacing:2,mb:2,children:[t.jsx(a,{sx:{bgcolor:"primary.main"},children:t.jsx(o,{})}),t.jsx(c,{variant:"h5",fontWeight:700,children:"Emo-Buddy - AI Companion"})]}),t.jsxs(i,{sx:e=>({minHeight:320,maxHeight:400,overflowY:"auto",mb:2,background:"dark"===e.palette.mode?e.palette.grey[900]:e.palette.grey[50],borderRadius:2,p:2,border:`1px solid ${e.palette.divider}`}),children:[0===u.length&&!f&&t.jsx(S,{}),u.map(e=>t.jsx(i,{sx:{display:"flex",justifyContent:e.isUser?"flex-end":"flex-start",mb:1},children:t.jsx(i,{sx:{bgcolor:e.isUser?"primary.main":"action.hover",color:e.isUser?"primary.contrastText":"text.primary",px:2,py:1,borderRadius:2,maxWidth:"80%",fontSize:"1rem",boxShadow:1},children:e.content})},e.id)),f&&t.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[t.jsx(d,{size:16}),t.jsx(c,{variant:"body2",children:"Emo Buddy is typing..."})]}),t.jsx("div",{ref:T})]}),C&&t.jsx(c,{color:"error",mb:2,children:C}),t.jsxs(r,{direction:"row",spacing:1,children:[t.jsx(b,{fullWidth:!0,placeholder:"Type your message...",value:y,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},disabled:f,size:"small",sx:{borderRadius:2}}),t.jsx(l,{color:"primary",onClick:R,disabled:!y.trim()||f,sx:{borderRadius:2},children:t.jsx(m,{})})]}),t.jsx(x,{variant:"text",color:"secondary",sx:{mt:2},onClick:async()=>{await(async()=>{if(!h)return;const e=Date.now();if(!(e-E.current<2e3)){E.current=e;try{await fetch(`${v}/end-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:h})})}catch(s){}}})(),p(null),j([]),g(""),I(null),W(!1)},children:"New Session"})]})})};export{C as EmoBuddy,C as default};
