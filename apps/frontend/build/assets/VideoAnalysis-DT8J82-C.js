import{r as e,i as a,k as n,l as t,b as i,j as s,B as o,T as r,V as l,U as d,a as c,P as m,m as x,n as h,o as u,L as p,C as g}from"./index-Cu1Lb5wm.js";import{S as f}from"./SimpleCharts-ETGG5eVb.js";import{C as b}from"./Card-DfkK2QiN.js";import{T as y,a as j}from"./Tabs-CKCUqr9g.js";import{C as v}from"./CardContent-CM-AlMCa.js";import{G as C}from"./Grid-DWJmqObS.js";import{L as k}from"./LinearProgress-H4j6QmzZ.js";import"./index-C8e1yo6j.js";const w=async e=>{const a=new FormData;if("string"==typeof e){const n=atob(e.split(",")[1]),t=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(n.length),s=new Uint8Array(i);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);const o=new Blob([i],{type:t});a.append("file",o,"frame.jpg")}else a.append("file",e,"frame.jpg");try{const e=await fetch("http://localhost:8001/analyze-video",{method:"POST",body:a});if(e.ok){return await e.json()}{const e=await n.post("/analyze-video",a,{headers:{"Content-Type":"multipart/form-data"}}),{emotion:t}=e.data,i=Date.now();return{emotions:[{emotion:t,confidence:1,timestamp:i}],dominantEmotion:t,averageConfidence:1,timestamp:i}}}catch(t){console.warn("Video API not available, falling back to integrated backend:",t);const e=await n.post("/analyze-video",a,{headers:{"Content-Type":"multipart/form-data"}}),{emotion:i}=e.data,s=Date.now();return{emotions:[{emotion:i,confidence:1,timestamp:s}],dominantEmotion:i,averageConfidence:1,timestamp:s}}},z=async(e=10)=>{try{const a=await fetch(`http://localhost:8001/analyze-video-continuous?duration=${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();if(n.error)throw new Error(n.error);return n}catch(a){throw console.error("Error in continuous video analysis:",a),a}},P=({children:e,value:a,index:n})=>s.jsx("div",{hidden:a!==n,style:{paddingTop:24},children:a===n&&e}),E=()=>{var a;const[n,E]=e.useState(0),[T,A]=e.useState(null),[S,I]=e.useState(!1),[R,W]=e.useState(!1),{showSuccess:D,showError:M}=t(),{addAnalysisResult:_}=i(),{error:F,isActive:B,videoRef:L,start:G,stop:N}=(()=>{const[a,n]=e.useState(null),[t,i]=e.useState(null),[s,o]=e.useState(!1),r=e.useRef(null),l=e.useCallback(async()=>{try{i(null);const e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"}});n(e),o(!0),r.current&&(r.current.srcObject=e)}catch(e){const a=e;let n="Failed to access camera";"NotAllowedError"===a.name?n="Camera access denied. Please allow camera permissions in your browser settings.":"NotFoundError"===a.name?n="No camera found. Please connect a camera and try again.":"NotReadableError"===a.name&&(n="Camera is already in use by another application."),i(n),o(!1)}},[]),d=e.useCallback(()=>{a&&(a.getTracks().forEach(e=>e.stop()),n(null)),o(!1),i(null)},[a]),c=e.useCallback(()=>{if(!r.current||!s)return null;const e=document.createElement("canvas"),a=r.current,n=e.getContext("2d");return n?(e.width=a.videoWidth,e.height=a.videoHeight,n.drawImage(a,0,0),e.toDataURL("image/jpeg",.8)):null},[s]);return e.useEffect(()=>()=>{a&&a.getTracks().forEach(e=>e.stop())},[a]),{stream:a,error:t,isActive:s,videoRef:r,start:l,stop:d,capture:c}})(),O=(null==T?void 0:T.emotions.slice(0,6).map(e=>({emotion:e.emotion,confidence:Math.round(100*e.confidence)})))||[],U={labels:O.map(e=>e.emotion),datasets:[{label:"Confidence",data:O.map(e=>e.confidence),backgroundColor:"#6366f1"}]};return s.jsxs(o,{children:[s.jsxs(o,{sx:{textAlign:"center",mb:4,mt:2,animation:"fadeIn 1.2s cubic-bezier(0.4,0,0.2,1)","@keyframes fadeIn":{from:{opacity:0,transform:"translateY(-30px)"},to:{opacity:1,transform:"none"}}},children:[s.jsx(r,{variant:"h3",component:"h1",sx:{fontWeight:700,mb:2,background:"linear-gradient(90deg, #6366f1, #7c3aed, #06b6d4, #f59e42, #6366f1)",backgroundSize:"200% auto",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",animation:"gradientMove 3s linear infinite","@keyframes gradientMove":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}},position:"relative",zIndex:1},children:"Video Emotion Analysis"}),s.jsx(o,{sx:{width:320,maxWidth:"80vw",height:6,mx:"auto",borderRadius:3,background:"linear-gradient(90deg, #6366f1, #7c3aed, #06b6d4, #f59e42, #6366f1)",backgroundSize:"200% auto",animation:"underlineMove 3s linear infinite","@keyframes underlineMove":{"0%":{backgroundPosition:"0% 50%"},"50%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0% 50%"}},mt:1,mb:3,opacity:.85}}),s.jsx(r,{variant:"h6",color:"text.secondary",children:"Analyze emotions from live video or uploaded images using advanced AI"})]}),s.jsxs(b,{sx:{mb:4},children:[s.jsxs(y,{value:n,onChange:(e,a)=>{E(a),B&&N()},variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:[s.jsx(j,{icon:s.jsx(l,{}),label:"Live Camera",iconPosition:"start"}),s.jsx(j,{icon:s.jsx(d,{}),label:"Upload Image",iconPosition:"start"})]}),s.jsx(P,{value:n,index:0,children:s.jsx(v,{children:s.jsxs(C,{container:!0,spacing:4,children:[s.jsx(C,{item:!0,xs:12,md:8,children:s.jsxs(o,{sx:{position:"relative",borderRadius:2,overflow:"hidden",backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)",border:e=>`1px solid ${e.palette.divider}`,aspectRatio:"4/3"},children:[s.jsx("video",{ref:L,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",display:B?"block":"none"}}),!B&&s.jsxs(o,{sx:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"text.secondary"},children:[s.jsx(o,{sx:{fontSize:64,mb:2,display:"flex",justifyContent:"center"},children:s.jsx(l,{})}),s.jsx(r,{variant:"h6",children:"Camera not active"}),s.jsx(r,{variant:"body2",children:'Click "Start Camera" to begin'})]})]})}),s.jsx(C,{item:!0,xs:12,md:4,children:s.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[B?s.jsxs(s.Fragment,{children:[s.jsx(c,{variant:"contained",color:"primary",size:"large",startIcon:s.jsx(l,{}),onClick:async()=>{W(!0),A(null);try{const e=await z(10);A(e),_("video",e),D("Continuous video analysis complete! Enhanced emotion detection used.")}catch(e){M("Continuous analysis failed. Camera may not be available.")}finally{W(!1)}},disabled:S||R,fullWidth:!0,sx:{mb:1},children:"ðŸŽ¯ Enhanced Analysis (10s)"}),s.jsx(c,{variant:"outlined",startIcon:s.jsx(x,{}),onClick:N,fullWidth:!0,children:"Stop Camera"})]}):s.jsx(c,{variant:"contained",size:"large",startIcon:s.jsx(m,{}),onClick:G,fullWidth:!0,children:"Start Camera"}),s.jsx(c,{variant:"outlined",startIcon:s.jsx(h,{}),onClick:()=>{A(null),N()},fullWidth:!0,children:"Reset"}),F&&s.jsx(u,{severity:"error",sx:{mt:2},children:F})]})})]})})}),s.jsx(P,{value:n,index:1,children:s.jsx(v,{children:s.jsxs(o,{sx:{border:"2px dashed",borderColor:"divider",borderRadius:2,p:6,textAlign:"center",backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.03)"},children:[s.jsx(o,{sx:{fontSize:64,color:"text.secondary",mb:2,display:"flex",justifyContent:"center"},children:s.jsx(d,{})}),s.jsx(r,{variant:"h6",sx:{mb:2},children:"Upload an image to analyze emotions"}),s.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Supported formats: JPG, PNG, GIF (max 10MB)"}),s.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{var a;const n=null==(a=e.target.files)?void 0:a[0];if(n)if(n.type.startsWith("image/"))if(n.size>10485760)M("Image file is too large. Please select a file under 10MB.");else{I(!0);try{const e=await w(n);A(e),_("video",e),D("Image analyzed successfully!")}catch(t){M("Failed to analyze image. Please try again.")}finally{I(!1)}}else M("Please select a valid image file.")},style:{display:"none"},id:"image-upload"}),s.jsx("label",{htmlFor:"image-upload",children:s.jsx(c,{variant:"contained",component:"span",startIcon:s.jsx(d,{}),size:"large",children:"Choose Image"})})]})})})]}),(S||R)&&s.jsx(b,{sx:{mb:4},children:s.jsx(v,{children:s.jsx(p,{message:R?"ðŸŽ¯ Performing enhanced emotion analysis for 10 seconds...":"Analyzing emotions..."})})}),T&&!S&&s.jsxs(C,{container:!0,spacing:4,children:[s.jsx(C,{item:!0,xs:12,md:6,children:s.jsx(b,{children:s.jsxs(v,{children:[s.jsxs(r,{variant:"h5",sx:{fontWeight:600,mb:3},children:["Analysis Results",(null==T?void 0:T.analysis_details)&&s.jsx(g,{label:"Enhanced Analysis",color:"primary",size:"small",sx:{ml:2}})]}),s.jsxs(o,{sx:{p:3,borderRadius:2,background:"linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%)",mb:3},children:[s.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Dominant Emotion"}),s.jsx(r,{variant:"h4",sx:{fontWeight:700,textTransform:"capitalize",color:"primary.main",mb:1},children:T.dominantEmotion}),s.jsxs(r,{variant:"body2",color:"text.secondary",children:["Average confidence: ",Math.round(100*T.averageConfidence),"%"]}),(null==T?void 0:T.analysis_details)&&s.jsxs(o,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[s.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["ðŸŽ¯ Analysis Quality: ",T.analysis_details.confidence_level]}),s.jsxs(r,{variant:"body2",color:"text.secondary",children:["ðŸ“Š Total Detections: ",T.analysis_details.total_detections]})]})]}),s.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:T.emotions.slice(0,5).map((e,a)=>s.jsxs(o,{children:[s.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsx(r,{variant:"body1",sx:{textTransform:"capitalize",fontWeight:500},children:e.emotion}),s.jsx(g,{label:`${Math.round(100*e.confidence)}%`,size:"small",color:0===a?"primary":"default"})]}),s.jsx(k,{variant:"determinate",value:100*e.confidence,sx:{height:8,borderRadius:4,backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{borderRadius:4,background:0===a?"linear-gradient(135deg, #2563eb 0%, #7c3aed 100%)":"linear-gradient(135deg, #6b7280 0%, #9ca3af 100%)"}}})]},e.emotion))}),(null==(a=null==T?void 0:T.analysis_details)?void 0:a.target_emotions_analysis)&&s.jsxs(o,{sx:{mt:4},children:[s.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:2},children:"ðŸŽ­ Target Emotions Analysis"}),s.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:Object.entries(T.analysis_details.target_emotions_analysis).map(([e,a])=>s.jsxs(o,{sx:{p:2,borderRadius:2,backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.03)",border:"1px solid",borderColor:"divider"},children:[s.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[s.jsx(r,{variant:"body1",sx:{textTransform:"capitalize",fontWeight:500},children:e}),s.jsx(g,{label:a.intensity,size:"small",color:"STRONG"===a.intensity?"error":"MODERATE"===a.intensity?"warning":"MILD"===a.intensity?"info":"default"})]}),s.jsxs(r,{variant:"body2",color:"text.secondary",children:[a.percentage.toFixed(1),"% presence (",a.count," detections)"]})]},e))})]})]})})}),s.jsx(C,{item:!0,xs:12,md:6,children:s.jsx(b,{children:s.jsxs(v,{children:[s.jsx(r,{variant:"h5",sx:{fontWeight:600,mb:3},children:"Confidence Distribution"}),O.length>0&&s.jsx(f,{data:U,options:{plugins:{legend:{display:!1}}}})]})})})]})]})};export{E as VideoAnalysis};
