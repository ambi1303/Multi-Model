import{r as e,j as t}from"./index-Cu1Lb5wm.js";import{M as n,i as o,u as s,P as r,a as i,b as c,L as l}from"./proxy-DY8aGLi2.js";class u extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=o(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=n-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function a({children:o,isPresent:s,anchorX:r,root:i}){const c=e.useId(),l=e.useRef(null),a=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:f}=e.useContext(n);return e.useInsertionEffect(()=>{const{width:e,height:t,top:n,left:o,right:u}=a.current;if(s||!l.current||!e||!t)return;const h="left"===r?`left: ${o}`:`right: ${u}`;l.current.dataset.motionPopId=c;const p=document.createElement("style");f&&(p.nonce=f);const d=i??document.head;return d.appendChild(p),p.sheet&&p.sheet.insertRule(`\n          [data-motion-pop-id="${c}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            ${h}px !important;\n            top: ${n}px !important;\n          }\n        `),()=>{d.removeChild(p),d.contains(p)&&d.removeChild(p)}},[s]),t.jsx(u,{isPresent:s,childRef:l,sizeRef:a,children:e.cloneElement(o,{ref:l})})}const f=({children:n,initial:o,isPresent:i,onExitComplete:c,custom:l,presenceAffectsLayout:u,mode:f,anchorX:p,root:d})=>{const m=s(h),x=e.useId();let g=!0,E=e.useMemo(()=>(g=!1,{id:x,initial:o,isPresent:i,custom:l,onExitComplete:e=>{m.set(e,!0);for(const t of m.values())if(!t)return;c&&c()},register:e=>(m.set(e,!1),()=>m.delete(e))}),[i,m,c]);return u&&g&&(E={...E}),e.useMemo(()=>{m.forEach((e,t)=>m.set(t,!1))},[i]),e.useEffect(()=>{!i&&!m.size&&c&&c()},[i]),"popLayout"===f&&(n=t.jsx(a,{isPresent:i,anchorX:p,root:d,children:n})),t.jsx(r.Provider,{value:E,children:n})};function h(){return new Map}const p=e=>e.key||"";function d(t){const n=[];return e.Children.forEach(t,t=>{e.isValidElement(t)&&n.push(t)}),n}const m=({children:n,custom:o,initial:r=!0,onExitComplete:u,presenceAffectsLayout:a=!0,mode:h="sync",propagate:m=!1,anchorX:x="left",root:g})=>{const[E,P]=i(m),C=e.useMemo(()=>d(n),[n]),j=m&&!E?[]:C.map(p),R=e.useRef(!0),w=e.useRef(C),y=s(()=>new Map),[v,$]=e.useState(C),[L,M]=e.useState(C);c(()=>{R.current=!1,w.current=C;for(let e=0;e<L.length;e++){const t=p(L[e]);j.includes(t)?y.delete(t):!0!==y.get(t)&&y.set(t,!1)}},[L,j.length,j.join("-")]);const X=[];if(C!==v){let e=[...C];for(let t=0;t<L.length;t++){const n=L[t],o=p(n);j.includes(o)||(e.splice(t,0,n),X.push(n))}return"wait"===h&&X.length&&(e=X),M(d(e)),$(C),null}const{forceRender:A}=e.useContext(l);return t.jsx(t.Fragment,{children:L.map(e=>{const n=p(e),s=!(m&&!E)&&(C===L||j.includes(n));return t.jsx(f,{isPresent:s,initial:!(R.current&&!r)&&void 0,custom:o,presenceAffectsLayout:a,mode:h,root:g,onExitComplete:s?void 0:()=>{if(!y.has(n))return;y.set(n,!0);let e=!0;y.forEach(t=>{t||(e=!1)}),e&&(null==A||A(),M(w.current),m&&(null==P||P()),u&&u())},anchorX:x,children:e},n)})})};export{m as A};
