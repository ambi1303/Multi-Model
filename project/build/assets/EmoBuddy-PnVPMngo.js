import{r as e,R as s,j as t,B as i,v as n,Q as r,f as a,E as o,T as c,a0 as d,I as l,a1 as x,a as m,o as h,aE as p,a9 as u,aa as j,aF as y,aG as f,ac as g,aH as w}from"./index-bax0hkam.js";import{T as b}from"./TextField-CU5ktAVN.js";import"./useControlled-CqooemHa.js";import"./FormControl-CwjXMIId.js";const v="http://localhost:9000/emo-buddy",S=()=>t.jsxs(i,{sx:{p:2},children:[t.jsx(c,{variant:"h6",gutterBottom:!0,children:"Welcome to Emo Buddy - Your AI Therapeutic Companion"}),t.jsx(h,{severity:"info",icon:t.jsx(p,{}),sx:{mb:2},children:"I'm here to provide emotional support and therapeutic guidance using evidence-based techniques. Everything is confidential and supportive."}),t.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"What I can help with:"}),t.jsxs(u,{dense:!0,children:[t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(f,{color:"success"})}),t.jsx(g,{primary:"Processing difficult emotions"})]}),t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(f,{color:"success"})}),t.jsx(g,{primary:"Managing stress and anxiety"})]}),t.jsxs(j,{children:[t.jsx(y,{sx:{minWidth:32},children:t.jsx(f,{color:"success"})}),t.jsx(g,{primary:"Developing coping strategies"})]})]}),t.jsxs(h,{severity:"warning",icon:t.jsx(w,{}),sx:{mt:2},children:[t.jsx("b",{children:"Important:"})," I'm an AI companion, not a replacement for professional help. If you're in crisis, please contact emergency services."]}),t.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Ready to chat? Just start typing!"})]}),I=()=>{const[h,p]=e.useState(null),[u,j]=e.useState([]),[y,f]=e.useState(""),[g,w]=e.useState(!1),[I,T]=e.useState(null),C=e.useRef(null),[E,D]=e.useState(!1),R=e.useRef(0);s.useEffect(()=>{var e;null==(e=C.current)||e.scrollIntoView({behavior:"smooth"})},[u]);const W=async()=>{if(!y.trim())return;w(!0),T(null);const e={id:Date.now().toString(),content:y.trim(),isUser:!0,timestamp:new Date};j(s=>[...s,e]),f("");try{if(E){if(h){if(!h||!e.content)return T("Session or message missing."),void w(!1);const s=await fetch(`${v}/continue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:h,user_message:e.content})});if(!s.ok)throw new Error((await s.json()).detail||"Failed to continue session");const t=await s.json();j(e=>[...e,{id:(Date.now()+1).toString(),content:t.response,isUser:!1,timestamp:new Date}])}}else{const s=await fetch(`${v}/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_message:e.content})});if(!s.ok)throw new Error((await s.json()).detail||"Failed to start session");const t=await s.json();p(t.session_id),j(e=>[...e,{id:(Date.now()+1).toString(),content:t.response,isUser:!1,timestamp:new Date}]),D(!0)}}catch(s){T(s.message||"Something went wrong.")}finally{w(!1)}};return t.jsx(i,{sx:{maxWidth:600,mx:"auto",mt:4,p:2},children:t.jsxs(n,{elevation:3,sx:{p:3,borderRadius:4},children:[t.jsxs(r,{direction:"row",alignItems:"center",spacing:2,mb:2,children:[t.jsx(a,{sx:{bgcolor:"primary.main"},children:t.jsx(o,{})}),t.jsx(c,{variant:"h5",fontWeight:700,children:"Emo-Buddy - AI Companion"})]}),t.jsxs(i,{sx:{minHeight:320,maxHeight:400,overflowY:"auto",mb:2,background:"#f9f9fb",borderRadius:2,p:2,border:"1px solid #e0e0e0"},children:[0===u.length&&!g&&t.jsx(S,{}),u.map(e=>t.jsx(i,{sx:{display:"flex",justifyContent:e.isUser?"flex-end":"flex-start",mb:1},children:t.jsx(i,{sx:{bgcolor:e.isUser?"primary.main":"grey.200",color:e.isUser?"primary.contrastText":"text.primary",px:2,py:1,borderRadius:2,maxWidth:"80%",fontSize:"1rem",boxShadow:1},children:e.content})},e.id)),g&&t.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[t.jsx(d,{size:16}),t.jsx(c,{variant:"body2",children:"Emo Buddy is typing..."})]}),t.jsx("div",{ref:C})]}),I&&t.jsx(c,{color:"error",mb:2,children:I}),t.jsxs(r,{direction:"row",spacing:1,children:[t.jsx(b,{fullWidth:!0,placeholder:"Type your message...",value:y,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),W())},disabled:g,size:"small",sx:{borderRadius:2}}),t.jsx(l,{color:"primary",onClick:W,disabled:!y.trim()||g,sx:{borderRadius:2},children:t.jsx(x,{})})]}),t.jsx(m,{variant:"text",color:"secondary",sx:{mt:2},onClick:async()=>{await(async()=>{if(!h)return;const e=Date.now();if(!(e-R.current<2e3)){R.current=e;try{await fetch(`${v}/end-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:h})})}catch(s){}}})(),p(null),j([]),f(""),T(null),D(!1)},children:"New Session"})]})})};export{I as EmoBuddy,I as default};
